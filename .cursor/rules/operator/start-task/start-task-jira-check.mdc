---
description: 在 start-task 檢查 Jira 單時需要遵守的原則，特別是優先檢查 RD 提供的建議
alwaysApply: false
---
# Start-Task Jira Ticket 檢查原則

此規則定義了在執行 `start-task` 指令時，檢查和分析 Jira ticket 時需要遵守的原則。

## 適用場景

此規則適用於 `start-task` 指令執行過程中，當 AI 需要：
- 讀取 Jira ticket 信息
- 分析 ticket 的需求和描述
- 制定開發計劃
- 顯示 ticket 信息給用戶

## 核心原則：優先檢查 RD 建議

**CRITICAL**: 在分析 Jira ticket 時，**必須優先檢查**是否有 RD（開發者）提供的建議或指示，特別是標記給 AI 的內容。

### 檢查位置

在讀取 Jira ticket 信息後，必須檢查以下位置是否有 RD 建議：

1. **Ticket 描述（Description）**
   - 檢查描述內容中是否包含標記給 AI 的建議
   - 需要解析 Jira 的結構化描述格式（ADF - Atlassian Document Format）

2. **Ticket 評論（Comments）**
   - 檢查所有評論中是否包含標記給 AI 的建議
   - 優先檢查最新的評論

3. **Ticket 標題（Summary）**
   - 檢查標題中是否包含特殊標記

### 搜尋格式（不區分大小寫）

必須搜尋以下格式的標記：

- `for AI`
- `to AI`
- `AI suggestion`
- `AI suggestion:`
- `for AI:`
- `to AI:`
- `@AI`（如果 Jira 支持 @ 提及功能）

### 處理流程

**如果找到 RD 建議：**

1. **優先顯示**：在顯示 ticket 信息時，必須優先顯示 RD 建議，並明確標記
2. **納入計劃**：將 RD 建議納入開發計劃的優先考慮事項
3. **明確標記**：在分析結果中明確標記哪些是 RD 的建議，哪些是 AI 的推斷
4. **詢問確認**：在詢問用戶確認計劃時，特別詢問 RD 建議是否理解正確

**如果未找到 RD 建議：**

- 按照標準流程分析 ticket 並制定計劃
- 基於 ticket 類型、描述等進行常規分析

### 顯示格式範例

當找到 RD 建議時，應該在顯示 ticket 信息時使用以下格式：

```
📋 Jira Ticket 信息
============================================================
單號: FE-7846
標題: [Ticket Summary]
類型: Feature
狀態: In Progress
負責人: [Assignee]
優先級: High

🎯 RD 建議（優先處理）
============================================================
[顯示找到的 RD 建議內容，明確標記來源]

📝 描述:
[顯示完整的 ticket 描述]

🎯 初步開發計劃
============================================================
[基於 RD 建議和 ticket 內容制定的計劃]
```

### 實施要求

在 `start-task.mjs` 腳本中，當執行以下函數時必須遵守此原則：

1. **`getJiraTicketInfo(ticket)`**：
   - 獲取 ticket 信息時，同時獲取評論（comments）
   - 確保返回的數據包含完整的描述和評論

2. **`analyzeTicketAndPlan(ticketData)`**：
   - 在分析 ticket 之前，先檢查是否有 RD 建議
   - 如果找到建議，優先處理並納入計劃
   - 在返回的分析結果中明確標記 RD 建議

3. **顯示分析結果時**：
   - 優先顯示 RD 建議
   - 明確區分 RD 建議和 AI 推斷
   - 在制定計劃時優先考慮 RD 建議

### 範例場景

**場景 1：描述中包含 RD 建議**

```
Ticket 描述：
這是一個新功能開發。

for AI: 請優先考慮使用現有的 UserProfile 組件，不要重新創建。
需要特別注意響應式設計，確保在移動端正常顯示。
```

**處理方式**：
- 在顯示 ticket 信息時，優先顯示 "for AI" 標記的建議
- 在制定開發計劃時，將「使用現有 UserProfile 組件」作為優先事項
- 在計劃中明確標記這是 RD 的建議

**場景 2：評論中包含 RD 建議**

```
評論（最新）：
@AI suggestion: 這個功能需要與後端 API /api/v2/users 整合，
請確保使用 createCustomizeQuery 而不是直接使用 fetch。
```

**處理方式**：
- 檢查評論時發現 "AI suggestion" 標記
- 在顯示 ticket 信息時，將此評論作為 RD 建議優先顯示
- 在制定計劃時，明確要求使用 `createCustomizeQuery`

## 開發流程相關規則

關於開發過程中的原則，包括：
- AI 獨立完成項目的標記和 MR 處理
- 開發完成後的報告生成
- 完成修改後的確認與自動提交流程
- MR 報告檢附規則

請參考：[development-policy.mdc](mdc:.cursor/rules/operator/start-task/development-policy.mdc)

## 注意事項

1. **格式靈活性**：搜尋時不區分大小寫，但必須完整匹配關鍵字（如 "for AI" 必須是完整詞組）
2. **優先級**：RD 建議的優先級高於 AI 的常規推斷
3. **明確標記**：必須明確區分哪些是 RD 建議，哪些是 AI 推斷，避免混淆
4. **完整性**：如果 ticket 有多個 RD 建議，必須全部顯示，不能遺漏
5. **上下文理解**：理解 RD 建議的上下文，確保建議被正確納入開發計劃
