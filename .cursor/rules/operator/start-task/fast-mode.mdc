---
description: 定義 start-task 快速模式（Fast Mode）下的強制 SOP，確保批次排程、目標導向推進、分支策略、Jira 指示必讀與最終回報流程一致
alwaysApply: false
---

<!-- cSpell:disable -->

# Start-Task 快速模式 SOP（Fast Mode）

此規則補齊 `start-task` **快速模式**下的強制 SOP，目標是讓 AI 在處理「多張獨立單」時可以：
「先確認排程清單 → 逐單目標導向推進（不中斷確認）→ 全部完成後一次性回報」。

## 適用場景

- 用戶在 `start-task` 選擇 **快速模式 (fast)**。
- 需要一次排程多張獨立 Jira 單，且希望 AI 以目標導向快速推進。

## 名詞定義

| 名詞 | 定義 |
|---|---|
| **排程清單** | 本次要處理的 Jira 單號列表（含順序） |
| **停止點** | 需等待用戶回覆/決策才能繼續的狀態（例如：資訊不足、衝突、需要授權） |
| **快速模式授權點** | 用戶確認排程清單且同意進入快速模式後，AI 才能開始不中斷推進 |

---

## 🚨 快速模式「確保」事項（必做）

### 1) 先與用戶確認「排程清單」是否完整（可追加/調整）

**CRITICAL**：快速模式在開始任何開發前，AI **必須先**與用戶確認本次要排程的單號清單，並詢問是否需要追加。

**輸出格式（必須使用表格）**：

```
📋 快速模式：排程清單確認

| 順序 | 單號 | 備註 |
|---|---|---|
| 1 | {TICKET_1} | - |
| 2 | {TICKET_2} | - |

❓ 請確認：
1) 以上是否為本次要排程的單？是否要追加/移除/調整順序？
2) 確認後我將進入「快速模式」並自動推進（不中斷逐步確認）。
```

> **注意**：只有在用戶明確確認排程清單後，才能開始執行（此為快速模式的授權點）。

### 2) 每張單開始前：必須先讀過 Jira 內的指示（Description + Comments）

**CRITICAL**：開始處理任何一張單前，AI **必須先讀取** Jira ticket 內容，尤其是：
- Description 的需求/限制/for AI 指示
- Comments 的最新補充/AI suggestion/決策資訊

**腳本路徑（依 Pantheon 掛載狀態擇一）**：
- 掛載到其他專案：`.pantheon/.cursor/scripts/jira/read-jira-ticket.mjs`
- Pantheon 專案本身：`.cursor/scripts/jira/read-jira-ticket.mjs`

### 3) 分支策略：每張單獨立 feature branch（branch name 直接使用單號）

**CRITICAL**：快速模式下，每張單開發都必須使用**不同的 feature branch**，且：

1. **每完成一張單後**：必須切回 `main`
2. **下一張單開始前**：必須從 `main` 重新 branch out
3. **分支命名**：branch name **直接使用單號**（例如：`FE-1234`）

**⚠️ 特別聲明（Sub-task 分支策略）**：
快速模式下，即使 Jira ticket 為 `Sub-task`，**仍一律使用「輸入單號」作為 branch name**（此點為快速模式的明確規範，與其他模式不同）。

**停止點**：
- 若分支已存在且無法安全判斷是否可直接沿用 → **停止並詢問用戶**
- 若 `main` 有未提交變更/有進行中的 rebase 等 → **停止並詢問用戶**

### 4) 目標導向推進（不中斷逐步確認）

**CRITICAL**：在用戶確認排程清單後，快速模式下 AI 可以：
- 自行判斷最佳解（以達成目標為首要條件）
- 自動推進各項步驟（不中斷逐步確認）

但仍必須遵守以下 **停止點**（任一成立即停止並等待用戶）：

| 停止點 | 典型原因 |
|---|---|
| **資訊不足** | Jira 缺關鍵資訊、需求不明確、需要 RD/用戶決策 |
| **衝突/阻塞** | merge conflict、rebase conflict、無法合併依賴 |
| **需要授權** | 需要修改受保護目錄（例如 `.cursor/rules/` / `.cursor/scripts/` / `.cursor/commands/`）但未取得授權 |
| **不可安全自動處理** | 任何可能造成用戶變更遺失或不可逆的操作（例如需要 stash/drop） |

### 5) 全部排程完成後：一次性回報 + 系統通知

**CRITICAL**：快速模式必須在**所有排程項目完成後**，才做一次性整理回報，並發送系統通知請用戶回來確認。

**回報格式（必須使用表格）**：

```
✅ 快速模式：本次排程完成

| 順序 | 單號 | 分支 | 狀態 | MR | 備註 |
|---|---|---|---|---|---|
| 1 | {TICKET_1} | {BRANCH_1} | ✅ 完成 | {MR_LINK_1} | - |
| 2 | {TICKET_2} | {BRANCH_2} | ❌ 失敗/⏸️ 待處理 | - | {WHY} |

📌 請用戶確認：
- 是否需要我針對「失敗/待處理」項目繼續處理？
```

> 若中途觸發停止點（需要用戶回覆），仍必須依通知規範發送系統通知（例如：`待處理` / `等待回覆`）。

---

## 快速模式檢查清單（必做）

- [ ] 已輸出排程清單表格，並詢問是否需要追加/調整
- [ ] 用戶已確認排程清單（快速模式授權點）
- [ ] 每張單開始前已讀取 Jira 指示（Description + Comments）
- [ ] 每張單使用獨立分支，且 branch name 直接使用單號
- [ ] 每完成一張單後已切回 `main`，下一張單從 `main` 重新 branch out
- [ ] 若遇停止點已停止並等待用戶（而非繼續硬推）
- [ ] 全部排程完成後已輸出一次性總結回報並發送系統通知
